<div>
  @if (!address || !address.postcode) {
    <div class="mb-3">
      <a class="text-primary" (click)="showFormFields = !showFormFields"
        >Enter address manually</a
      >
    </div>
  }
  @if (!address || !address.postcode) {
    <div class="mb-3">
      <label class="form-label" for="postcodeInput">Find address by postcode:</label>
      <address-search-box
        (loading)="loading = $event"
        (results)="updateAddresses($event)"
        [disable]="false"
        id="addressSearchBox-{{ uuid }}"
      >
      </address-search-box>
    </div>
  }
  @if (addresses) {
    <select
      class="col mb-2"
      [(ngModel)]="selectedAddress"
      (ngModelChange)="onAddressChange($event)"
      id="selectedAddress-{{ uuid }}"
    >
      <option disabled selected [ngValue]="null">-- select an option --</option>
      @for (address of addresses; track address) {
        <option [ngValue]="address">
          {{ address.line1+', '+address.line2  }}
        </option>
      }
    </select>
  }
</div>
<form [formGroup]="addressForm">
  @if (showFormFields) {
    <div>
      <div class="mb-2">
        <label for="inputAddressFirstLine-{{ uuid }}" class="form-label">Line 1 *</label>
        <input
          type="text"
          formControlName="addressfirstline"
          class="form-control"
          id="inputAddressFirstLine-{{ uuid }}"
          [ngClass]="{
            'is-invalid': submitted && f['addressfirstline'].errors,
          }"
        />
        @if (submitted && f["addressfirstline"].errors) {
          <div class="invalid-feedback">
            @if (f["addressfirstline"].errors["required"]) {
              <div>Line 1 is required</div>
            }
          </div>
        }
      </div>
      <div class="mb-2">
        <label for="inputAddressSecondLine-{{ uuid }}">Line 2</label>
        <input
          type="text"
          formControlName="addresssecondline"
          class="form-control"
          id="inputAddressSecondLine-{{ uuid }}"
        />
      </div>
      <div class="mb-2">
        <label for="inputCity-{{ uuid }}">City *</label>
        <input
          type="text"
          formControlName="city"
          class="form-control"
          [ngClass]="{ 'is-invalid': submitted && f['city'].errors }"
          id="inputCity-{{ uuid }}"
        />
        @if (submitted && f["city"].errors) {
          <div class="invalid-feedback">
            @if (f["city"].errors["required"]) {
              <div>City is required</div>
            }
          </div>
        }
      </div>
      <div class="mb-2">
        <label for="inputCounty-{{ uuid }}">County</label>
        <input type="text" formControlName="county" class="form-control" id="inputCounty-{{ uuid }}"/>
      </div>
      <div class="mb-2">
        <label for="postcodeManualInput-{{ uuid }}">Postcode *</label>
        <input
          type="text"
          formControlName="postcode"
          class="form-control"
          [ngClass]="{ 'is-invalid': submitted && f['postcode'].errors }"
          id="postcodeManualInput-{{ uuid }}"
        />
        @if (submitted && f["postcode"].errors) {
          <div class="invalid-feedback">
            @if (f["postcode"].errors["required"]) {
              <div>Postcode is required</div>
            }
          </div>
        }
      </div>
      <label for="countrySelect-{{ uuid }}">Country *</label>
      <select
        formControlName="country"
        id="countrySelect-{{ uuid }}"
        name="countrySelect"
        class="form-control"
      >
        <option disabled selected [ngValue]="null">Select</option>
        @for (country of countries; track country) {
          <option [ngValue]="country.id">
            {{ country.name }}
          </option>
        }
      </select>
    </div>
  }
</form>
