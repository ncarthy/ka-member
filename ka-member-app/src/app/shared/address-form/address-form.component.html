<div>
  @if (!address || !address.postcode) {
    <div class="mb-3">
      <a class="text-primary" (click)="showFormFields = !showFormFields"
        >Enter address manually</a
      >
    </div>
  }
  @if (!address || !address.postcode) {
    <div class="mb-3">
      <label class="form-label" for="postcodeInput">Find address by postcode:</label>
      <address-search-box
        (loading)="loading = $event"
        (results)="updateAddresses($event)"
        [disable]="false"
        id="addressSearchBox"
      >
      </address-search-box>
    </div>
  }
  @if (addresses) {
    <!-- NSC    Missing a NgModel call here!-->
    <select
      class="col mb-2"
      [(ngModel)]="selectedAddress"
      (ngModelChange)="onAddressChange($event)"
      name="selectedAddress"
    >
      <option disabled selected [ngValue]="null">-- select an option --</option>
      @for (address of addresses; track address) {
        <option [ngValue]="address">
          {{ address.line1+', '+address.line2  }}
        </option>
      }
    </select>
    <!-- NSC 16/9/25 trying to get it to compile
      <select
        class="col mb-2"
        [(ngModel)]="selectedAddress"
        (ngModelChange)="onAddressChange($event)"
        name="selectedAddress"
        >
        <option disabled selected [ngValue]="null">-- select an option --</option>
        @for (address of addresses; track address) {
          <option [ngValue]="address">
            {{ address.line1 }}
          </option>
        }
      </select>-->
  }
</div>
<form [formGroup]="addressForm">
  @if (showFormFields) {
    <div>
      <div class="mb-2">
        <label for="inputManualAddressFirstLine" class="form-label">Line 1 *</label>
        <input
          type="text"
          formControlName="addressfirstline"
          class="form-control"
          id="inputManualAddressFirstLine"
          [ngClass]="{
            'is-invalid': submitted && f['addressfirstline'].errors,
          }"
        />
        @if (submitted && f["addressfirstline"].errors) {
          <div class="invalid-feedback">
            @if (f["addressfirstline"].errors["required"]) {
              <div>Line 1 is required</div>
            }
          </div>
        }
      </div>
      <div class="mb-2">
        <label for="inputManualAddressSecondLine">Line 2</label>
        <input
          type="text"
          formControlName="addresssecondline"
          class="form-control"
          id="inputManualAddressSecondLine"
        />
      </div>
      <div class="mb-2">
        <label for="inputManualCity">City *</label>
        <input
          type="text"
          formControlName="city"
          class="form-control"
          [ngClass]="{ 'is-invalid': submitted && f['city'].errors }"
          id="inputManualCity"
        />
        @if (submitted && f["city"].errors) {
          <div class="invalid-feedback">
            @if (f["city"].errors["required"]) {
              <div>City is required</div>
            }
          </div>
        }
      </div>
      <div class="mb-2">
        <label for="inputManualCounty">County</label>
        <input type="text" formControlName="county" class="form-control" id="inputManualCounty"/>
      </div>
      <div class="mb-2">
        <label for="postcodeManualInput">Postcode *</label>
        <input
          type="text"
          formControlName="postcode"
          class="form-control"
          [ngClass]="{ 'is-invalid': submitted && f['postcode'].errors }"
          id="postcodeManualInput"
        />
        @if (submitted && f["postcode"].errors) {
          <div class="invalid-feedback">
            @if (f["postcode"].errors["required"]) {
              <div>Postcode is required</div>
            }
          </div>
        }
      </div>
      <label for="countrySelect">Country *</label>
      <select
        formControlName="country"
        id="countrySelect"
        name="countrySelect"
        class="form-control"
      >
        <option disabled selected [ngValue]="null">Select</option>
        @for (country of countries; track country) {
          <option [ngValue]="country.id">
            {{ country.name }}
          </option>
        }
      </select>
    </div>
  }
</form>
